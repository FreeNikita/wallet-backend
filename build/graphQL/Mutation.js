"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.resolversMutation = exports.typeDefsMutation = void 0;var _user = _interopRequireDefault(require("./../modules/user"));
var _wallet = _interopRequireDefault(require("../modules/wallet"));function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}

const typeDefsMutation = `
    type Mutation {
        setUser(firebase_id: String!): User
        createWallet(
            user_id: String,
            name: String,
            amount: Int,
            currency: String,
            type: String,
        ): Wallet
        
        removeWallet(
            wallet_id: String,
            user_id: String
        ): Id
        
        updateWallet(
            wallet_id: String,
            user_id: String,
            name: String,
            amount: Int,
            currency: String,
            type: String,
        ): Wallet
        
        addTransaction(
            wallet_id: String,
            user_id: String,
           
            amount: Int,
            title: String,
            category: String,
            subCategory: String,
            date: String,
            description: String,
        ): Status
        
        removeTransaction(
            wallet_id: String,
            user_id: String,
            trans_id: String,
            trans_amount: Int
        ): Status
        
        updateTransaction(
            wallet_id: String,
            user_id: String,
            trans_id: String
        ): String
    }
`;

// Move to USER_MODULES
exports.typeDefsMutation = typeDefsMutation;
const resolversMutation = {
  setUser: async (_, { firebase_id }) => {
    try {
      let user = await _user.default.findOne({
        firebase_id });


      if (user) return user;

      user = await new _user.default({
        firebase_id });


      return await user.save();
    } catch (err) {
      console.log('setUser: ', err);
    }
  },
  createWallet: async (_, params) => {
    try {
      const { user_id, name = '', amount = 0, currency = '', type = '' } = params;

      const wallet = await new _wallet.default({
        user_id,
        name,
        amount,
        currency,
        type });


      return await wallet.save();
    } catch (err) {
      console.log('createWallet: ', err);
    }
  },
  removeWallet: async (_, params) => {
    try {
      const { wallet_id, user_id } = params;
      await _wallet.default.findOneAndDelete({
        _id: wallet_id,
        user_id });


      return { id: wallet_id };
    } catch (err) {
      console.log('removeWallet: ', err);
    }
  },
  updateWallet: async (_, params) => {
    try {
      const { wallet_id, user_id, ...fields } = params;
      const wallet = await _wallet.default.findOneAndUpdate(
      {
        _id: wallet_id,
        user_id },

      { ...fields },
      {
        new: true });


      return wallet;
    } catch (err) {
      console.log('removeWallet: ', err);
    }
  },

  addTransaction: async (_, params) => {
    try {
      const { wallet_id, user_id, amount, ...fields } = params;
      const wallet = await _wallet.default.findOne({
        _id: wallet_id,
        user_id });


      wallet.history.push({
        ...fields,
        amount });


      wallet.amount = wallet.amount + amount;

      await wallet.save();
      return {
        status: "success" };

    } catch (err) {
      console.log('removeWallet: ', err);
    }
  },

  removeTransaction: async (_, params) => {
    try {
      const { wallet_id, user_id, trans_id } = params;
      const wallet = await _wallet.default.findOne({
        _id: wallet_id,
        user_id });


      const { amount } = wallet.history.find(({ id }) => id === trans_id);
      await wallet.updateOne({
        amount: wallet.amount - amount,
        $pull: {
          history: { _id: trans_id } } });



      return {
        status: "success" };

    } catch (err) {
      console.log('removeWallet: ', err);
    }
  },

  updateTransaction: () => {
    return {
      status: "Is not ready" };

  } };exports.resolversMutation = resolversMutation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ncmFwaFFML011dGF0aW9uLmpzIl0sIm5hbWVzIjpbInR5cGVEZWZzTXV0YXRpb24iLCJyZXNvbHZlcnNNdXRhdGlvbiIsInNldFVzZXIiLCJfIiwiZmlyZWJhc2VfaWQiLCJ1c2VyIiwiVXNlciIsImZpbmRPbmUiLCJzYXZlIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZVdhbGxldCIsInBhcmFtcyIsInVzZXJfaWQiLCJuYW1lIiwiYW1vdW50IiwiY3VycmVuY3kiLCJ0eXBlIiwid2FsbGV0IiwiV2FsbGV0IiwicmVtb3ZlV2FsbGV0Iiwid2FsbGV0X2lkIiwiZmluZE9uZUFuZERlbGV0ZSIsIl9pZCIsImlkIiwidXBkYXRlV2FsbGV0IiwiZmllbGRzIiwiZmluZE9uZUFuZFVwZGF0ZSIsIm5ldyIsImFkZFRyYW5zYWN0aW9uIiwiaGlzdG9yeSIsInB1c2giLCJzdGF0dXMiLCJyZW1vdmVUcmFuc2FjdGlvbiIsInRyYW5zX2lkIiwiZmluZCIsInVwZGF0ZU9uZSIsIiRwdWxsIiwidXBkYXRlVHJhbnNhY3Rpb24iXSwibWFwcGluZ3MiOiJ5SUFBQTtBQUNBLG1FOztBQUVPLE1BQU1BLGdCQUFnQixHQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQUExQjs7QUFvRFA7O0FBRU8sTUFBTUMsaUJBQWlCLEdBQUc7QUFDN0JDLEVBQUFBLE9BQU8sRUFBRSxPQUFPQyxDQUFQLEVBQVMsRUFBQ0MsV0FBRCxFQUFULEtBQTJCO0FBQ2hDLFFBQUk7QUFDQSxVQUFJQyxJQUFJLEdBQUcsTUFBTUMsY0FBS0MsT0FBTCxDQUFhO0FBQzFCSCxRQUFBQSxXQUQwQixFQUFiLENBQWpCOzs7QUFJQSxVQUFHQyxJQUFILEVBQVMsT0FBT0EsSUFBUDs7QUFFVEEsTUFBQUEsSUFBSSxHQUFHLE1BQU0sSUFBSUMsYUFBSixDQUFTO0FBQ2xCRixRQUFBQSxXQURrQixFQUFULENBQWI7OztBQUlBLGFBQU8s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QUExQixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFVzZXIgZnJvbSAnLi8uLi9tb2R1bGVzL3VzZXInXG5pbXBvcnQgV2FsbGV0IGZyb20gJy4uL21vZHVsZXMvd2FsbGV0J1xuXG5leHBvcnQgY29uc3QgdHlwZURlZnNNdXRhdGlvbiA9IGBcbiAgICB0eXBlIE11dGF0aW9uIHtcbiAgICAgICAgc2V0VXNlcihmaXJlYmFzZV9pZDogU3RyaW5nISk6IFVzZXJcbiAgICAgICAgY3JlYXRlV2FsbGV0KFxuICAgICAgICAgICAgdXNlcl9pZDogU3RyaW5nLFxuICAgICAgICAgICAgbmFtZTogU3RyaW5nLFxuICAgICAgICAgICAgYW1vdW50OiBJbnQsXG4gICAgICAgICAgICBjdXJyZW5jeTogU3RyaW5nLFxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICApOiBXYWxsZXRcbiAgICAgICAgXG4gICAgICAgIHJlbW92ZVdhbGxldChcbiAgICAgICAgICAgIHdhbGxldF9pZDogU3RyaW5nLFxuICAgICAgICAgICAgdXNlcl9pZDogU3RyaW5nXG4gICAgICAgICk6IElkXG4gICAgICAgIFxuICAgICAgICB1cGRhdGVXYWxsZXQoXG4gICAgICAgICAgICB3YWxsZXRfaWQ6IFN0cmluZyxcbiAgICAgICAgICAgIHVzZXJfaWQ6IFN0cmluZyxcbiAgICAgICAgICAgIG5hbWU6IFN0cmluZyxcbiAgICAgICAgICAgIGFtb3VudDogSW50LFxuICAgICAgICAgICAgY3VycmVuY3k6IFN0cmluZyxcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgKTogV2FsbGV0XG4gICAgICAgIFxuICAgICAgICBhZGRUcmFuc2FjdGlvbihcbiAgICAgICAgICAgIHdhbGxldF9pZDogU3RyaW5nLFxuICAgICAgICAgICAgdXNlcl9pZDogU3RyaW5nLFxuICAgICAgICAgICBcbiAgICAgICAgICAgIGFtb3VudDogSW50LFxuICAgICAgICAgICAgdGl0bGU6IFN0cmluZyxcbiAgICAgICAgICAgIGNhdGVnb3J5OiBTdHJpbmcsXG4gICAgICAgICAgICBzdWJDYXRlZ29yeTogU3RyaW5nLFxuICAgICAgICAgICAgZGF0ZTogU3RyaW5nLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFN0cmluZyxcbiAgICAgICAgKTogU3RhdHVzXG4gICAgICAgIFxuICAgICAgICByZW1vdmVUcmFuc2FjdGlvbihcbiAgICAgICAgICAgIHdhbGxldF9pZDogU3RyaW5nLFxuICAgICAgICAgICAgdXNlcl9pZDogU3RyaW5nLFxuICAgICAgICAgICAgdHJhbnNfaWQ6IFN0cmluZyxcbiAgICAgICAgICAgIHRyYW5zX2Ftb3VudDogSW50XG4gICAgICAgICk6IFN0YXR1c1xuICAgICAgICBcbiAgICAgICAgdXBkYXRlVHJhbnNhY3Rpb24oXG4gICAgICAgICAgICB3YWxsZXRfaWQ6IFN0cmluZyxcbiAgICAgICAgICAgIHVzZXJfaWQ6IFN0cmluZyxcbiAgICAgICAgICAgIHRyYW5zX2lkOiBTdHJpbmdcbiAgICAgICAgKTogU3RyaW5nXG4gICAgfVxuYFxuXG4vLyBNb3ZlIHRvIFVTRVJfTU9EVUxFU1xuXG5leHBvcnQgY29uc3QgcmVzb2x2ZXJzTXV0YXRpb24gPSB7XG4gICAgc2V0VXNlcjogYXN5bmMgKF8se2ZpcmViYXNlX2lkfSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoe1xuICAgICAgICAgICAgICAgIGZpcmViYXNlX2lkXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpZih1c2VyKSByZXR1cm4gdXNlclxuXG4gICAgICAgICAgICB1c2VyID0gYXdhaXQgbmV3IFVzZXIoe1xuICAgICAgICAgICAgICAgIGZpcmViYXNlX2lkLFxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHVzZXIuc2F2ZSgpXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NldFVzZXI6ICcsIGVycilcbiAgICAgICAgfVxuICAgIH0sXG4gICAgY3JlYXRlV2FsbGV0OiBhc3luYyAoXywgcGFyYW1zKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7dXNlcl9pZCwgbmFtZSA9ICcnLCBhbW91bnQgPSAwLCBjdXJyZW5jeSA9ICcnLCB0eXBlID0gJycgfSA9IHBhcmFtcztcblxuICAgICAgICAgICAgY29uc3Qgd2FsbGV0ID0gYXdhaXQgbmV3IFdhbGxldCh7XG4gICAgICAgICAgICAgICAgdXNlcl9pZCxcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgICAgICBjdXJyZW5jeSxcbiAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgd2FsbGV0LnNhdmUoKVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGVXYWxsZXQ6ICcsIGVycilcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVtb3ZlV2FsbGV0OiBhc3luYyAoXywgcGFyYW1zKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHdhbGxldF9pZCwgdXNlcl9pZCB9ID0gcGFyYW1zO1xuICAgICAgICAgICAgYXdhaXQgV2FsbGV0LmZpbmRPbmVBbmREZWxldGUoe1xuICAgICAgICAgICAgICAgIF9pZDogd2FsbGV0X2lkLFxuICAgICAgICAgICAgICAgIHVzZXJfaWRcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiB7IGlkOiB3YWxsZXRfaWQgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVXYWxsZXQ6ICcsIGVycilcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlV2FsbGV0OiBhc3luYyAoXywgcGFyYW1zKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHdhbGxldF9pZCwgdXNlcl9pZCwgLi4uZmllbGRzIH0gPSBwYXJhbXM7XG4gICAgICAgICAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCBXYWxsZXQuZmluZE9uZUFuZFVwZGF0ZShcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIF9pZDogd2FsbGV0X2lkLFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7Li4uZmllbGRzfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5ldzogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiB3YWxsZXRcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlV2FsbGV0OiAnLCBlcnIpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkVHJhbnNhY3Rpb246IGFzeW5jIChfLCBwYXJhbXMpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgd2FsbGV0X2lkLCB1c2VyX2lkLCBhbW91bnQsIC4uLmZpZWxkcyB9ID0gcGFyYW1zO1xuICAgICAgICAgICAgY29uc3Qgd2FsbGV0ID0gYXdhaXQgV2FsbGV0LmZpbmRPbmUoe1xuICAgICAgICAgICAgICAgIF9pZDogd2FsbGV0X2lkLFxuICAgICAgICAgICAgICAgIHVzZXJfaWRcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHdhbGxldC5oaXN0b3J5LnB1c2goe1xuICAgICAgICAgICAgICAgIC4uLmZpZWxkcyxcbiAgICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHdhbGxldC5hbW91bnQgPSB3YWxsZXQuYW1vdW50ICsgYW1vdW50XG5cbiAgICAgICAgICAgIGF3YWl0IHdhbGxldC5zYXZlKClcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcInN1Y2Nlc3NcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVXYWxsZXQ6ICcsIGVycilcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVUcmFuc2FjdGlvbjogYXN5bmMgKF8sIHBhcmFtcykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyB3YWxsZXRfaWQsIHVzZXJfaWQsIHRyYW5zX2lkIH0gPSBwYXJhbXM7XG4gICAgICAgICAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCBXYWxsZXQuZmluZE9uZSh7XG4gICAgICAgICAgICAgICAgX2lkOiB3YWxsZXRfaWQsXG4gICAgICAgICAgICAgICAgdXNlcl9pZCxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGNvbnN0IHsgYW1vdW50IH0gPSB3YWxsZXQuaGlzdG9yeS5maW5kKCh7aWR9KSA9PiBpZCA9PT0gdHJhbnNfaWQpXG4gICAgICAgICAgICBhd2FpdCB3YWxsZXQudXBkYXRlT25lKHtcbiAgICAgICAgICAgICAgICBhbW91bnQ6IHdhbGxldC5hbW91bnQgLSBhbW91bnQsXG4gICAgICAgICAgICAgICAgJHB1bGw6IHtcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeToge19pZDogdHJhbnNfaWR9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwic3VjY2Vzc1wiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZVdhbGxldDogJywgZXJyKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZVRyYW5zYWN0aW9uOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0dXM6IFwiSXMgbm90IHJlYWR5XCJcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==